{% extends 'base.html' %}

{% block title %}{{ project.name }} - SiteSphere{% endblock %}

{% block page_title %}{{ project.name }}{% endblock %}

{% block extra_css %}
<style>
/* Tighten the analysis card spacing and force canvas to use full container */
.project-analytics .card-body{padding:12px 12px 8px 12px}
.project-analytics .chart-container{height:180px;margin:0}
#budgetChart{display:block !important;width:100% !important;height:100% !important}
#progressSpark{display:block !important;width:100% !important}
.projects-analytics-row > [class*="col-"]{align-self:flex-start}
.projects-analytics-row{align-items:flex-start !important}
.projects-analytics-row .card{height:auto}
.project-analytics .card{height:auto}
.project-analytics .card-body{display:flex;flex-direction:column}
.project-analytics .chart-container{flex:0 0 280px}
.project-analytics .spark-wrap{flex:0 0 auto}

/* Analytics Dashboard Styles */
.metric-card {
    padding: 15px;
    border-radius: 12px;
    background: rgba(124, 58, 237, 0.05);
    border: 1px solid rgba(124, 58, 237, 0.1);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.metric-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(124, 58, 237, 0.15);
}

.milestone-item {
    padding: 8px 0;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
}

.milestone-item:last-child {
    border-bottom: none;
}

.risk-indicator {
    padding: 6px 0;
}

.risk-indicator .progress {
    border-radius: 4px;
}
</style>
{% endblock %}

{% block content %}
<!-- Project Header -->
<div class="row mb-4">
    <div class="col-md-8">
        <div class="d-flex align-items-center mb-2">
            <span class="badge bg-{% if project.status == 'active' %}success{% elif project.status == 'completed' %}primary{% elif project.status == 'on_hold' %}warning{% else %}secondary{% endif %} me-3">
                {{ project.get_status_display }}
            </span>
            <span class="text-muted">Created {{ project.created_at|date:"M d, Y" }}</span>
        </div>
        <p class="text-muted mb-1">
            <i class="fas fa-building me-2"></i>
            {{ project.company_name }}
        </p>
        <p class="text-muted">
            <i class="fas fa-map-marker-alt me-2"></i>
            {{ project.project_address }}
        </p>
    </div>
    <div class="col-md-4 text-end">
        <div class="btn-group">
            <a href="{% url 'projects:expense_add' project.id %}" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>
                Add Expense
            </a>
            <a href="{% url 'projects:edit' project.id %}" class="btn btn-outline-primary">
                <i class="fas fa-edit me-2"></i>
                Edit Project
            </a>
            <a href="{% url 'projects:delete' project.id %}" class="btn btn-outline-danger">
                <i class="fas fa-trash me-2"></i>
                Delete
            </a>
        </div>
    </div>
</div>

<!-- Key Metrics -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <i class="fas fa-percentage fa-2x mb-2"></i>
                <h3 class="mb-1">{{ overall_progress|default:project.completion_percentage }}%</h3>
                <p class="mb-0">Overall Progress</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card stat-card success">
            <div class="card-body text-center">
                <i class="fas fa-indian-rupee-sign fa-2x mb-2"></i>
                <h3 class="mb-1">₹{{ project.estimated_budget|floatformat:0 }}</h3>
                <p class="mb-0">Budget</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card stat-card {% if project.actual_cost > project.estimated_budget %}danger{% else %}warning{% endif %}">
            <div class="card-body text-center">
                <i class="fas fa-credit-card fa-2x mb-2"></i>
                <h3 class="mb-1">₹{{ project.actual_cost|floatformat:0 }}</h3>
                <p class="mb-0">Spent</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card stat-card {% if profit_margin > 0 %}success{% else %}danger{% endif %}">
            <div class="card-body text-center">
                <i class="fas fa-chart-line fa-2x mb-2"></i>
                <h3 class="mb-1">{{ profit_margin|floatformat:1 }}%</h3>
                <p class="mb-0">Profit Margin</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card stat-card warning">
            <div class="card-body text-center">
                <i class="fas fa-gauge fa-2x mb-2"></i>
                <h3 class="mb-1">{{ spi|default:"-" }}</h3>
                <p class="mb-0">Schedule Performance (SPI)</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card stat-card danger">
            <div class="card-body text-center">
                <i class="fas fa-scale-balanced fa-2x mb-2"></i>
                <h3 class="mb-1">{{ cpi|default:"-" }}</h3>
                <p class="mb-0">Cost Performance (CPI)</p>
            </div>
        </div>
    </div>
</div>

<!-- Charts and Analytics -->
<div class="row mb-4 projects-analytics-row" style="align-items:flex-start;">
    <!-- Project Timeline -->
    <div class="col-md-6 mb-3 project-analytics">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="fas fa-timeline me-2 text-primary"></i>
                    Project Timeline
                </h5>
            </div>
            <div class="card-body">
                {% if timeline_events %}
                    {% for event in timeline_events %}
                    <div class="timeline-item {% if event.is_completed %}completed{% endif %}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">{{ event.title }}</h6>
                                <p class="text-muted mb-1">{{ event.description|truncatechars:100 }}</p>
                                <small class="text-muted">{{ event.date|date:"M d, Y" }}</small>
                            </div>
                            {% if event.is_milestone %}
                            <span class="badge bg-warning">Milestone</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                <p class="text-muted text-center">No timeline events yet</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Budget vs Actual Chart -->
    <div class="col-md-6 mb-3 project-analytics">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="fas fa-chart-bar me-2 text-primary"></i>
                    Progress Trend & Budget Analysis
                </h5>
            </div>
            <div class="card-body p-3" style="padding-bottom:8px !important;">
                <div class="chart-container" style="height:auto;min-height:260px;">
                    <canvas id="budgetChart"></canvas>
                </div>
                <div class="mt-1 spark-wrap" style="margin-top:6px !important;">
                    <small class="text-muted">Last 14 days progress</small>
                    <canvas id="progressSpark" height="40"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Project Analytics Dashboard -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-graph-up me-2 text-primary"></i>
                    Project Analytics Dashboard
                </h5>
            </div>
            <div class="card-body">
                <!-- Project Metrics -->
                <div class="row mb-4">
                    <div class="col-md-3 mb-3">
                        <div class="metric-card text-center">
                            <div class="metric-icon bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                                <i class="bi bi-speedometer2"></i>
                            </div>
                            <h4 class="text-primary mb-1">{{ project.completion_percentage|default:0 }}%</h4>
                            <small class="text-muted">Completion Rate</small>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="metric-card text-center">
                            <div class="metric-icon bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                                <i class="bi bi-currency-rupee"></i>
                            </div>
                            <h4 class="text-success mb-1">₹{{ project.estimated_budget|floatformat:0|default:0 }}</h4>
                            <small class="text-muted">Total Budget</small>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="metric-card text-center">
                            <div class="metric-icon bg-warning text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                                <i class="bi bi-cash-stack"></i>
                            </div>
                            <h4 class="text-warning mb-1">₹{{ project.actual_cost|floatformat:0|default:0 }}</h4>
                            <small class="text-muted">Actual Cost</small>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="metric-card text-center">
                            <div class="metric-icon bg-info text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                                <i class="bi bi-calendar-check"></i>
                            </div>
                            <h4 class="text-info mb-1">{{ project_days|default:0 }}</h4>
                            <small class="text-muted">Days Active</small>
                        </div>
                    </div>
                </div>

                <!-- Analytics Charts -->
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-pie-chart me-2 text-info"></i>
                                    Budget Utilization
                                </h6>
                            </div>
                            <div class="card-body">
                                <canvas id="budgetUtilizationChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-bar-chart me-2 text-success"></i>
                                    Monthly Progress
                                </h6>
                            </div>
                            <div class="card-body">
                                <canvas id="monthlyProgressChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Project Health & Risk Assessment -->
                <div class="row">
                    <div class="col-md-8 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-heart-pulse me-2 text-danger"></i>
                                    Project Health Status
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="text-muted mb-3">Performance Indicators</h6>
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span>Budget Performance</span>
                                            <span class="badge bg-{% if budget_performance == 'excellent' %}success{% elif budget_performance == 'good' %}primary{% elif budget_performance == 'fair' %}warning{% else %}danger{% endif %}">
                                                {{ budget_performance|title }}
                                            </span>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span>Schedule Adherence</span>
                                            <span class="badge bg-{% if schedule_performance == 'excellent' %}success{% elif schedule_performance == 'good' %}primary{% elif schedule_performance == 'fair' %}warning{% else %}danger{% endif %}">
                                                {{ schedule_performance|title }}
                                            </span>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span>Quality Score</span>
                                            <span class="badge bg-{% if quality_score >= 80 %}success{% elif quality_score >= 60 %}primary{% elif quality_score >= 40 %}warning{% else %}danger{% endif %}">
                                                {{ quality_score|default:0 }}/100
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="text-muted mb-3">Risk Factors</h6>
                                        <div class="risk-indicator mb-2">
                                            <div class="d-flex justify-content-between">
                                                <span>Budget Risk</span>
                                                <div class="progress" style="width: 60px; height: 8px;">
                                                    <div class="progress-bar bg-{% if budget_risk == 'low' %}success{% elif budget_risk == 'medium' %}warning{% else %}danger{% endif %}" 
                                                         style="width: {% if budget_risk == 'low' %}25{% elif budget_risk == 'medium' %}50{% else %}75{% endif %}%"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="risk-indicator mb-2">
                                            <div class="d-flex justify-content-between">
                                                <span>Schedule Risk</span>
                                                <div class="progress" style="width: 60px; height: 8px;">
                                                    <div class="progress-bar bg-{% if schedule_risk == 'low' %}success{% elif schedule_risk == 'medium' %}warning{% else %}danger{% endif %}" 
                                                         style="width: {% if schedule_risk == 'low' %}25{% elif schedule_risk == 'medium' %}50{% else %}75{% endif %}%"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="risk-indicator mb-2">
                                            <div class="d-flex justify-content-between">
                                                <span>Resource Risk</span>
                                                <div class="progress" style="width: 60px; height: 8px;">
                                                    <div class="progress-bar bg-{% if resource_risk == 'low' %}success{% elif resource_risk == 'medium' %}warning{% else %}danger{% endif %}" 
                                                         style="width: {% if resource_risk == 'low' %}25{% elif resource_risk == 'medium' %}50{% else %}75{% endif %}%"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-trophy me-2 text-warning"></i>
                                    Project Milestones
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="milestone-item mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="milestone-icon bg-success text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 30px; height: 30px;">
                                            <i class="bi bi-check"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">Project Initiated</h6>
                                            <small class="text-muted">{{ project.created_at|date:"M d, Y" }}</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="milestone-item mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="milestone-icon bg-{% if project.completion_percentage >= 25 %}success{% else %}secondary{% endif %} text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 30px; height: 30px;">
                                            <i class="bi bi-{% if project.completion_percentage >= 25 %}check{% else %}clock{% endif %}"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">25% Complete</h6>
                                            <small class="text-muted">Foundation Phase</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="milestone-item mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="milestone-icon bg-{% if project.completion_percentage >= 50 %}success{% else %}secondary{% endif %} text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 30px; height: 30px;">
                                            <i class="bi bi-{% if project.completion_percentage >= 50 %}check{% else %}clock{% endif %}"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">50% Complete</h6>
                                            <small class="text-muted">Construction Phase</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="milestone-item">
                                    <div class="d-flex align-items-center">
                                        <div class="milestone-icon bg-{% if project.completion_percentage >= 100 %}success{% else %}secondary{% endif %} text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 30px; height: 30px;">
                                            <i class="bi bi-{% if project.completion_percentage >= 100 %}check{% else %}clock{% endif %}"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">100% Complete</h6>
                                            <small class="text-muted">Project Delivery</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Partners and Payments -->
<div class="row mb-4">
    <!-- Project Partners -->
    <div class="col-md-6 mb-3">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="fas fa-users me-2 text-primary"></i>
                    Project Partners
                </h5>
            </div>
            <div class="card-body">
                {% for partner in partners %}
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="d-flex align-items-center">
                        <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">{{ partner.name }}</h6>
                            <small class="text-muted">Age: {{ partner.age }} | {{ partner.phone_number }}</small>
                        </div>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-primary">{{ partner.proportion }}%</span>
                    </div>
                </div>
                {% empty %}
                <p class="text-muted text-center">No partners added</p>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <!-- Pending Payments -->
    <div class="col-md-6 mb-3">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="fas fa-clock me-2 text-primary"></i>
                    Pending Payments
                </h5>
            </div>
            <div class="card-body">
                {% for payment in pending_payments %}
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div>
                        <h6 class="mb-1">{{ payment.description }}</h6>
                        <small class="text-muted">Due: {{ payment.due_date|date:"M d, Y" }}</small>
                    </div>
                    <div class="text-end">
                        <div class="fw-bold text-success">₹{{ payment.amount }}</div>
                        <span class="badge bg-warning">{{ payment.get_status_display }}</span>
                    </div>
                </div>
                {% empty %}
                <p class="text-muted text-center">No pending payments</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Expense Breakdown -->
<div class="row">
    <div class="col-md-8 mb-3">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="fas fa-receipt me-2 text-primary"></i>
                    Recent Expenses
                </h5>
            </div>
            <div class="card-body">
                {% if expenses %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for expense in expenses|slice:":10" %}
                            <tr>
                                <td>
                                    <span class="badge bg-secondary">{{ expense.get_category_display }}</span>
                                </td>
                                <td>{{ expense.description }}</td>
                                <td class="fw-bold">₹{{ expense.amount }}</td>
                                <td>{{ expense.date|date:"M d, Y" }}</td>
                                <td class="text-end">
                                    <div class="btn-group btn-group-sm">
                                        <a href="{% url 'projects:expense_edit' project.id expense.id %}" class="btn btn-outline-primary">Edit</a>
                                        <form method="post" action="{% url 'projects:expense_delete' project.id expense.id %}" style="display:inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-outline-danger">Delete</button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted text-center">No expenses recorded</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Expense Categories Donut -->
    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="fas fa-chart-pie me-2 text-primary"></i>
                    Expense Categories
                </h5>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Budget vs Actual Chart
const ctx1 = document.getElementById('budgetChart').getContext('2d');
new Chart(ctx1, {
    type: 'bar',
    data: {
        labels: ['Budget', 'Actual Spent', 'Remaining'],
        datasets: [{
            data: [
                {{ project.estimated_budget }},
                {{ project.actual_cost }},
                {{ project.estimated_budget }} - {{ project.actual_cost }}
            ],
            backgroundColor: [
                '#2563eb',
                '{% if project.actual_cost > project.estimated_budget %}#ef4444{% else %}#10b981{% endif %}',
                '#f59e0b'
            ]
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: { padding: 0 },
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: { color: 'rgba(107, 114, 128, 0.1)', drawBorder: false },
                ticks: {
                    callback: function(value) {
                        return '₹' + value.toLocaleString();
                    }
                }
            }
        }
    }
});

// Progress sparkline
const sparkCtx = document.getElementById('progressSpark').getContext('2d');
new Chart(sparkCtx, {
    type: 'line',
    data: {
        labels: Array.from({length: {{ progress_spark|length|default:0 }}}, (_, i) => i+1),
        datasets: [{
            data: {{ progress_spark|default:'[]' }},
            borderColor: '#2563eb',
            backgroundColor: 'rgba(37,99,235,0.15)',
            fill: true,
            tension: 0.3,
            pointRadius: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: { padding: 0 },
        plugins: { legend: { display: false } },
        scales: {
            x: { display: false },
            y: { display: false }
        }
    }
});

// Expense Categories Chart
fetch('{% url "projects:analytics" project.id %}')
    .then(response => response.json())
    .then(data => {
        const ctx2 = document.getElementById('expenseChart').getContext('2d');
        new Chart(ctx2, {
            type: 'doughnut',
            data: {
                labels: Object.keys(data.expense_breakdown),
                datasets: [{
                    data: Object.values(data.expense_breakdown),
                    backgroundColor: [
                        '#2563eb',
                        '#10b981',
                        '#f59e0b',
                        '#ef4444',
                        '#8b5cf6',
                        '#06b6d4'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    }
                }
            }
        });
    });

    // Budget Utilization Chart
    const budgetUtilizationCtx = document.getElementById('budgetUtilizationChart');
    if (budgetUtilizationCtx) {
        const usedBudget = {{ project.actual_cost|default:0 }};
        const totalBudget = {{ project.estimated_budget|default:1 }};
        const remainingBudget = totalBudget - usedBudget;
        
        new Chart(budgetUtilizationCtx, {
            type: 'doughnut',
            data: {
                labels: ['Used Budget', 'Remaining Budget'],
                datasets: [{
                    data: [usedBudget, remainingBudget],
                    backgroundColor: [
                        'rgba(239, 68, 68, 0.8)',
                        'rgba(16, 185, 129, 0.8)'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const value = context.parsed;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(1);
                                return context.label + ': ₹' + value.toLocaleString() + ' (' + percentage + '%)';
                            }
                        }
                    }
                }
            }
        });
    }

    // Monthly Progress Chart
    const monthlyProgressCtx = document.getElementById('monthlyProgressChart');
    if (monthlyProgressCtx) {
        new Chart(monthlyProgressCtx, {
            type: 'bar',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Progress %',
                    data: [10, 25, 35, 45, 60, {{ project.completion_percentage|default:0 }}],
                    backgroundColor: 'rgba(124, 58, 237, 0.6)',
                    borderColor: 'rgba(124, 58, 237, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Progress %'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }
</script>
{% endblock %}